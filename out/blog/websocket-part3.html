<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="description" content="Learn how to go from API design to code generation. Create a WebSocket API for ChatBot. All supported by AsyncAPI"/><link rel="alternate" type="application/rss+xml" title="RSS Feed for AsyncAPI Initiative Blog" href="/rss.xml"/><link rel="icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="194x194" href="/favicon-194x194.png"/><meta itemProp="name" content="From API-First to Code Generation - A WebSocket Use Case | AsyncAPI Initiative for event-driven APIs"/><meta itemProp="description" content="Learn how to go from API design to code generation. Create a WebSocket API for ChatBot. All supported by AsyncAPI"/><meta itemProp="image" content="http://localhost:8080/img/posts/websocket-part3/cover.webp"/><meta name="twitter:card" value="summary_large_image"/><meta name="twitter:title" content="From API-First to Code Generation - A WebSocket Use Case | AsyncAPI Initiative for event-driven APIs"/><meta name="twitter:description" content="Learn how to go from API design to code generation. Create a WebSocket API for ChatBot. All supported by AsyncAPI"/><meta name="twitter:image" content="http://localhost:8080/img/posts/websocket-part3/cover.webp"/><meta property="og:title" content="From API-First to Code Generation - A WebSocket Use Case | AsyncAPI Initiative for event-driven APIs"/><meta property="og:type" content="article"/><meta property="og:url" content="http://localhost:8080/blog/websocket-part3"/><meta property="og:image" content="http://localhost:8080/img/posts/websocket-part3/cover.webp"/><meta property="og:description" content="Learn how to go from API design to code generation. Create a WebSocket API for ChatBot. All supported by AsyncAPI"/><title>From API-First to Code Generation - A WebSocket Use Case | AsyncAPI Initiative for event-driven APIs</title><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5cb852c7b57ed596" async=""></script><style>
                /* AddThis hack */

                #at4-share {
                    left: 50%;
                    margin-left: -500px !important;

                    &amp;amp;.addthis-animated {
                      animation-duration: 0s !important;
                    }
                }

                #at4-scc {
                    display: none !important;
                }
              </style><meta name="next-head-count" content="25"/><link rel="preload" href="/_next/static/css/cedf33f8fb65848f9ac5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cedf33f8fb65848f9ac5.css"/><link rel="preload" href="/_next/static/css/99208ff840280a9dc815.css" as="style"/><link rel="stylesheet" href="/_next/static/css/99208ff840280a9dc815.css"/><link rel="preload" href="/_next/static/Tex625tf_lnUaoCgL3YGh/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/Tex625tf_lnUaoCgL3YGh/pages/blog/websocket-part3.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.4dd1003cc9c949c7fcd3.js" as="script"/><link rel="preload" href="/_next/static/chunks/75fc9c18.3cfc8ccb85c1d7a11215.js" as="script"/><link rel="preload" href="/_next/static/chunks/ce56b752.ae226c74e10a6a4b10b8.js" as="script"/><link rel="preload" href="/_next/static/chunks/0557f841fc85a2834d7f888fce8afe60a4489f1d.c7c389ed4e650b7acdd9.js" as="script"/><link rel="preload" href="/_next/static/chunks/5d64a570782c3ceba4f83b61f6533a7ee91bc9f8.3990439058315e1f2df7.js" as="script"/><link rel="preload" href="/_next/static/chunks/be6d319af1fb18412639ef154d1e4d762d2a273e.4cb9699241b781436ae4.js" as="script"/><link rel="preload" href="/_next/static/chunks/4f5700c3a68d16ffc40162e6214bdf91e1aeaf40.af98a8a489a62e744487.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-9425739e3a9a3f3edaa6.js" as="script"/></head><body><div id="__next"><div class="max-w-4xl block   px-4 sm:px-6 lg:px-8 mx-auto block   px-4 sm:px-6 lg:px-8"><div class="relative bg-white  z-50"><div class="flex w-full justify-between items-center py-6 lg:justify-start lg:space-x-10"><div class="lg:w-auto lg:flex-1"><a href="/" class="flex"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 535.016 126.327" xml:space="preserve" class="h-8 w-auto sm:h-8"><g fill="#1D1D1B"><path d="M154.912 21.665h10.54l24.425 71.451h-8.713l-5.678-17.129h-30.402l-5.677 17.129h-8.816l24.321-71.451zm18.343 46.821l-12.87-38.917-13.173 38.917h26.043zM202.901 92.709c-3.212-1.555-5.796-3.699-7.752-6.436-1.964-2.736-3.042-5.861-3.245-9.375l7.5-1.723c.134 2.568.844 4.832 2.128 6.791 1.281 1.961 3.005 3.445 5.168 4.459 2.162 1.012 4.561 1.52 7.196 1.52 2.295 0 4.357-.336 6.183-1.014 1.822-.674 3.292-1.672 4.408-2.99 1.116-1.318 1.671-2.752 1.671-4.307 0-1.756-.606-3.191-1.822-4.309-1.219-1.113-2.706-1.99-4.46-2.633-1.757-.643-4.054-1.334-6.893-2.08-3.92-1.012-7.11-2.025-9.578-3.037-2.464-1.015-4.544-2.517-6.232-4.511-1.691-1.993-2.533-4.612-2.533-7.854 0-2.838.76-5.423 2.281-7.753 1.519-2.33 3.579-4.156 6.18-5.473 2.602-1.317 5.525-1.976 8.769-1.976 3.176 0 6.116.659 8.818 1.976 2.699 1.317 4.898 3.127 6.585 5.422 1.688 2.298 2.672 4.864 2.94 7.704l-7.5 1.924c-.136-3.105-1.232-5.555-3.294-7.348-2.062-1.787-4.646-2.684-7.752-2.684-1.757 0-3.361.337-4.816 1.012-1.452.675-2.599 1.621-3.444 2.838a6.952 6.952 0 00-1.267 4.054c0 1.758.609 3.192 1.825 4.306 1.216 1.114 2.448 1.926 3.701 2.432 1.249.508 3.831 1.202 7.75 2.08 3.717 1.013 6.842 2.093 9.375 3.241 2.534 1.151 4.646 2.704 6.333 4.663 1.688 1.961 2.535 4.393 2.535 7.297 0 3.041-.88 5.795-2.635 8.26-1.758 2.467-4.14 4.393-7.145 5.777-3.009 1.385-6.402 2.078-10.188 2.078-3.985.001-7.582-.776-10.79-2.331zM246.73 116.322a25.078 25.078 0 01-8.359-5.777 26.296 26.296 0 01-5.524-8.613l6.486-4.357c1.147 4.119 3.277 7.447 6.384 9.98s6.722 3.803 10.845 3.803c3.176 0 5.963-.795 8.359-2.383 2.399-1.588 4.292-3.75 5.678-6.486 1.385-2.734 2.078-5.828 2.078-9.271l-.102-6.893c-.947 1.689-2.197 3.191-3.749 4.51a18.41 18.41 0 01-5.17 3.09c-1.893.744-3.816 1.117-5.776 1.117-3.513 0-6.638-.863-9.375-2.584-2.737-1.723-4.849-4.088-6.333-7.096-1.488-3.006-2.229-6.469-2.229-10.389V41.934h7.702v33.039c0 2.57.472 4.814 1.419 6.74.943 1.926 2.295 3.463 4.052 4.611 1.754 1.15 3.784 1.723 6.081 1.723 2.497 0 4.762-.609 6.791-1.824 2.025-1.217 3.632-2.887 4.812-5.016 1.184-2.129 1.775-4.545 1.775-7.246V41.934h7.701l.102 51.283c0 4.797-1.012 9.102-3.041 12.92-2.025 3.816-4.831 6.807-8.411 8.969-3.583 2.162-7.602 3.244-12.059 3.244-3.584 0-6.961-.676-10.137-2.028zM290.513 41.934h6.994l.708 6.791c1.419-2.635 3.479-4.746 6.185-6.335 2.7-1.584 5.538-2.381 8.511-2.381 3.514 0 6.639.88 9.375 2.635 2.737 1.759 4.865 4.14 6.385 7.145 1.521 3.009 2.281 6.437 2.281 10.288v33.04h-7.804v-33.04c0-2.499-.457-4.728-1.37-6.689-.911-1.958-2.263-3.497-4.054-4.611-1.79-1.114-3.833-1.673-6.131-1.673-2.432 0-4.66.61-6.688 1.826-2.025 1.216-3.648 2.887-4.864 5.016-1.216 2.128-1.825 4.544-1.825 7.246v31.925h-7.702V41.934zM350 91.492c-3.646-2.365-6.483-5.623-8.511-9.779s-3.009-8.869-2.94-14.137c0-5.337.93-10.084 2.788-14.241 1.858-4.155 4.475-7.413 7.854-9.779 3.377-2.365 7.262-3.548 11.655-3.548 3.378 0 6.486.746 9.323 2.23a21.238 21.238 0 017.146 6.03c1.923 2.533 3.255 5.489 4.003 8.867l-7.4 2.027c-.946-3.714-2.585-6.689-4.915-8.917-2.33-2.23-5.084-3.345-8.26-3.345-2.701 0-5.169.878-7.397 2.635s-3.969 4.207-5.219 7.346c-1.251 3.143-1.877 6.708-1.877 10.694 0 3.986.693 7.535 2.08 10.639 1.383 3.109 3.31 5.559 5.776 7.35 2.466 1.791 5.254 2.686 8.36 2.686 2.7 0 5.15-.641 7.346-1.926 2.196-1.283 3.989-3.074 5.372-5.371 1.387-2.297 2.283-4.898 2.686-7.805l7.4 1.623c-.542 3.918-1.876 7.414-4.003 10.488-2.131 3.074-4.816 5.475-8.058 7.197-3.243 1.721-6.827 2.584-10.743 2.584-4.66.001-8.815-1.183-12.466-3.548zM412.529 21.36h15.001l24.426 71.755h-12.67l-4.966-15.912h-28.375l-5.27 15.912h-12.468l24.322-71.755zm19.055 46.013l-11.453-35.27-11.652 35.27h23.105zM458.743 21.36h28.176c4.797 0 9.087.949 12.87 2.84 3.782 1.891 6.773 4.526 8.969 7.903 2.196 3.379 3.296 7.232 3.296 11.555 0 4.324-1.082 8.157-3.245 11.503-2.163 3.343-5.152 5.996-8.969 7.955-3.816 1.96-8.092 2.939-12.822 2.939h-16.416v27.06h-11.858V21.36zm26.859 34.56c2.635 0 5.049-.523 7.246-1.572 2.194-1.045 3.918-2.497 5.167-4.357 1.252-1.856 1.876-3.969 1.876-6.333s-.607-4.475-1.823-6.335c-1.218-1.856-2.905-3.31-5.068-4.357-2.162-1.047-4.628-1.572-7.397-1.572h-15V55.92h14.999zM519.855 21.36h12.16v71.755h-12.16V21.36z"></path></g><path fill="#4775B9" d="M46.5 121.416c-23.583 0-42.768-14.301-42.768-31.879h8.469c0 12.908 15.387 23.408 34.299 23.408s34.299-10.5 34.299-23.408h8.469c.001 17.578-19.183 31.879-42.768 31.879zM89.269 33.878H80.8c0-12.906-15.387-23.407-34.299-23.407s-34.299 10.5-34.299 23.407h-8.47C3.732 16.3 22.918 2 46.5 2c23.585 0 42.769 14.3 42.769 31.878z"></path><path fill="#63BA90" d="M6.715 57.486H61.114999999999995V65.955H6.715z" transform="rotate(35.914 33.912 61.719)"></path><path fill="#63BA90" d="M32.225 57.438H86.625V65.906H32.225z" transform="rotate(35.914 59.422 61.671)"></path></svg></a></div><div class="-mr-2 -my-2 lg:hidden"><button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out"><svg class="h-6 w-6" stroke="currentColor" fill="none" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button></div><nav class="hidden lg:flex space-x-10"><div class="relative"><button type="button" class=" group text-gray-500 inline-flex items-center space-x-2 text-base leading-6 font-medium hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150"><span>Learning</span><svg class="text-gray-400 h-5 w-5 group-hover:text-gray-500 group-focus:text-gray-500 transition ease-in-out duration-150" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="relative"><button type="button" class=" group text-gray-500 inline-flex items-center space-x-2 text-base leading-6 font-medium hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150"><span>Tools</span><svg class="text-gray-400 h-5 w-5 group-hover:text-gray-500 group-focus:text-gray-500 transition ease-in-out duration-150" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><div class="relative"><button type="button" class=" group text-gray-500 inline-flex items-center space-x-2 text-base leading-6 font-medium hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150"><span>Community</span><svg class="text-gray-400 h-5 w-5 group-hover:text-gray-500 group-focus:text-gray-500 transition ease-in-out duration-150" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg></button></div><a href="/blog" target="_self" class=" text-base leading-6 font-medium text-gray-500 hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150">Blog</a><a href="/roadmap" target="_self" class="text-green-400 font-bold text-base leading-6 font-medium text-gray-500 hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150">Roadmap</a><a href="/jobs" target="_self" class="text-primary-500 font-bold text-base leading-6 font-medium text-gray-500 hover:text-gray-900 focus:outline-none focus:text-gray-900 transition ease-in-out duration-150">Jobs</a></nav><div class="hidden lg:flex lg:flex-1"></div></div></div></div><div class="max-w-4xl lg:flex lg:flex-row-reverse  px-4 sm:px-6 lg:px-8 mx-auto lg:flex lg:flex-row-reverse  px-4 sm:px-6 lg:px-8"><div class="bg-blue-100 mt-4 p-4 sticky top-0 overflow-y-auto max-h-screen lg:bg-transparent lg:mt-0 lg:pt-0 lg:pb-8 lg:top-4 lg:max-h-(screen-16) lg:border-l lg:border-gray-200 lg:min-w-40 lg:max-w-64 lg:-mr-20 xl:min-w-72 xl:-mr-36  lg:block z-20"><div class="flex cursor-pointer  lg:cursor-auto"><h5 class="false flex-1 text-primary-500 font-medium uppercase tracking-wide text-sm font-sans antialiased lg:mb-4 lg:text-xs lg:text-gray-500 lg:font-thin">On this page</h5><div class="text-underline text-center p4 lg:hidden"><svg class="rotate-90 transform transition duration-200 ease-in-out h-6 -mt-0.5 text-primary-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></div></div><div class="hidden lg:block"><div class=""><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#api-first-vs-code-first">API-First vs Code-First</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#shrekapp">ShrekApp</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#write-asyncapi-document">Write AsyncAPI document</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#info">Info</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#servers">Servers</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#channels">Channels</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#final-document">Final document</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#generate-code">Generate Code</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#asyncapi-generator">AsyncAPI Generator</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#generate-server-and-client">Generate Server and Client</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#code-walkthrough">Code Walkthrough</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#server-code">Server Code</a><a class="pl-4 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#router">Router</a><a class="pl-4 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#services">Services</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#client-code">Client Code</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#add-business-logic">Add Business Logic</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#add-travel-status-updates">Add Travel Status Updates</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#add-chatbot-communication">Add ChatBot Communication</a><a class="pl-0 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#summary">Summary</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#asyncapi-20-limitations">AsyncAPI 2.0 Limitations</a><a class="pl-2 block mb-1 transition duration-100 ease-in-out text-gray-500 font-normal text-sm font-sans antialiased hover:text-gray-700 hover:font-medium" href="#keeping-asyncapi-in-sync-with-code">Keeping AsyncAPI in Sync With Code</a></div></div></div><main class="mt-8 px-4 sm:px-6 lg:pr-8 lg:pl-0 lg:flex-1 lg:max-w-172 xl:max-w-172"><header class="pr-4 sm:pr-6 md:pr-8"><h1 class="text-4xl font-normal text-gray-800 font-sans antialiased">From API-First to Code Generation - A WebSocket Use Case</h1><div class="mt-6 flex items-center"><div class="relative flex-shrink-0"><a alt="Lukasz Gornicki" href="https://twitter.com/derberq"><img title="Lukasz Gornicki" class="relative mr-0 z-0 h-10 w-10 border-2 border-white rounded-full object-cover hover:z-50" src="/img/avatars/lpgornicki.webp"/></a></div><div class="ml-3"><p class="text-sm leading-5 font-medium text-gray-900"><span class="hover:underline"><a alt="Lukasz Gornicki" href="https://twitter.com/derberq">Lukasz Gornicki</a></span></p><div class="flex text-sm leading-5 text-gray-500"><time dateTime="2021-05-19T05:00:00.000Z">May 19, 2021</time><span class="mx-1">Â·</span><span>20<!-- --> min read</span></div></div></div></header><article class="mb-32"><img src="/img/posts/websocket-part3/cover.webp" class="mt-6 mb-6 w-full"/><blockquote class=" italic font-sans antialiased text-gray-400 border-l-4 border-gray-400 pl-4 pt-1 pb-1 pr-1 my-4 bg-white"><p class=" my-4 text-gray-700 font-normal font-sans antialiased"> This is the last article of WebSocket series. I recommend you read <a href="/blog/websocket-part1" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">WebSocket, Shrek, and AsyncAPI - An Opinionated Intro</a> and <a href="/blog/websocket-part2" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Creating AsyncAPI for WebSocket API - Step by Step</a> first.</p></blockquote><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In my previous articles from the WebSocket series, I introduced you to WebSocket topic and explained how you would describe your WebSocket API using AsyncAPI specification.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">What was the point of doing it anyway? Why learning the specification?</p><figure class="text-center"><img class="w-1/2 inline-block" src="/img/posts/websocket-part3/meme-newspec.webp"/></figure><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Just to document your API? Nah, that would be a huge waste of time. Like seriously, would you learn a new specification only to describe the API for documentation purposes? Please don&#x27;t. You could do so much more with it.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Look at the list of <a href="https://www.asyncapi.com/docs/community/tooling" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">all the tools</a> built for AsyncAPI. There are many ahead of us, but the current list already explains what can be done with AsyncAPI. You can validate your messages in real-time in your application with <a href="https://github.com/WaleedAshraf/asyncapi-validator" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">asyncapi-validator</a> or mock and test your application with <a href="https://microcks.io/" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Microcks</a>. You can also generate code by picking one of <a href="https://github.com/asyncapi/generator#list-of-official-generator-templates" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">the official templates</a>. In this article, I will focus on the aspect of code generation.</p><h2 id="api-first-vs-code-first" class=" my-4 font-sans antialiased font-medium text-xl">API-First vs Code-First</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Designing API first and then coding later is not an easy shift. For a coder, it is easier just to code and focus on code aspects. And this is just fine. That is how humans work. We do what we learned and focus on making things good and maintainable. Different tasks require different skills, and it is ok that not everybody has them. Designing API requires a different look on the subject, being more flexible and abstract. You need a wider perspective, forget about implementation details, and think about the user first.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Do you need the specification to design API?</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">No, but specification makes the design process and feedback loop easier to handle and faster. If backed by good tools, of course.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">What is wrong with generating AsyncAPI from code?</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Even though I&#x27;m an author of many memes like those in this article, I&#x27;m actually far from judging. It all depends on your project, architecture, and even the work environment. </p><figure class="text-center"><img class="w-1/2 inline-block" src="/img/posts/websocket-part3/meme-blame.webp"/></figure><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In the end, I think there is a wrong assumption that if you generate spec from code, it means you did not think about API design and your users. </p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Even AsyncAPI <a href="https://www.asyncapi.com/docs/community/tooling" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">tooling list</a> stigmatize tools that allow you to generate spec from the code as code-first tools. Who said you couldn&#x27;t do both things in parallel. </p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I just realized this topic could continue and evolve into a dedicated article, so let me do a full stop here. </p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">My goal is to educate you on:</p><ul class=" my-4 ml-4 list-disc text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Designing a WebSocket API with multichannel, with one message each. In other words, I want to show you something opposite to my previous articles where you could see a WebSocket API that has one channel but with multiple different messages.</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Performing code generation that enables you to focus on business logic only.</li></ul><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I&#x27;ll try to come back into <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">API-First vs Code-First</strong> topic in the summary of the article.</p><h2 id="shrekapp" class=" my-4 font-sans antialiased font-medium text-xl">ShrekApp</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I know that in <a href="/blog/websocket-part1" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">this article</a><undefined>, I wrote that I would not try to model a Shrek application. Since the moment I wrote I will not do it, I immediately started thinking about doing it <span role="img" aria-label="smiling face with open mouth">ðŸ˜ƒ</span> So here I am, showing you a possible use case for AsyncAPI with WebSocket protocol basing on Shrek. I shamefully admit I do it mainly to make sure my head moves on and thinks about something other than Shrek <span role="img" aria-label="smiling face with open mouth">ðŸ˜ƒ</span></undefined></p><h2 id="write-asyncapi-document" class=" my-4 font-sans antialiased font-medium text-xl">Write AsyncAPI document</h2><blockquote class=" italic font-sans antialiased text-gray-400 border-l-4 border-gray-400 pl-4 pt-1 pb-1 pr-1 my-4 bg-white"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">You can see entire AsyncAPI document <a href="https://github.com/derberg/shrekapp-asyncapi-designed/blob/main/asyncapi.yaml" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">here</a></p></blockquote><p class=" my-4 text-gray-700 font-normal font-sans antialiased">There are several questions you need to ask yourself when designing an API:</p><ul class=" my-4 ml-4 list-disc text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased">What is the name of the API?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">What is the purpose of the API?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">What is the version of the API?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">How user can connect with the API and over what protocol?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">What messages can your user receive from and send to your API?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">On what channels are these messages available?</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">What is the structure of these messages? What is the schema?</li></ul><p class=" my-4 text-gray-700 font-normal font-sans antialiased">These are basic questions that can be reflected in the AsyncAPI document.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In case you didn&#x27;t notice, these questions are user-oriented. Your AsyncAPI document must describe what users can do with your application and not what it does. It makes a difference.</p><h3 id="info" class=" my-4 font-sans antialiased font-medium text-lg">Info</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I&#x27;m designing a <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">ShrekApp</strong>, release under 1.0.0 version. Its purpose is to enable chat with a chatbot trained to behave like Shrek. I want to use <a href="https://wit.ai" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Wit.ai</a> as a platform for training the bot that gives me a REST API to talk to the bot.</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#7edcda">info:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  title:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Shrek</span><span> </span><span style="color:#c0e2a3;font-weight:500">App</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  version:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;1.0.0&#x27;</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  description:</span><span> </span><span style="color:#c0e2a3;font-weight:500">|
</span></span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">    Purpose of this app is to have some fun with AsyncAPI and WebSocket and define an interface for ... Shrek.
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">    ![](https://media.giphy.com/media/10Ug6rDDuG3YoU/giphy-downsized.gif)
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">    You can use this API to chat with Shrek bot or to get updates about artifical travels to different locations.
</span></code></pre></div></div></div></div><h3 id="servers" class=" my-4 font-sans antialiased font-medium text-lg">Servers</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The communication with the application goes over the WebSocket protocol. For now, it is not publicly hosted. You can run it locally and therefore connect through <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">localhost</strong> only.</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#7edcda">servers:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  swamp:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    url:</span><span> </span><span style="color:#c0e2a3;font-weight:500">localhost</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    protocol:</span><span> </span><span style="color:#c0e2a3;font-weight:500">ws</span></span></code></pre></div></div></div></div><h3 id="channels" class=" my-4 font-sans antialiased font-medium text-lg">Channels</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">There are two separate entry points for the user to interact with the API:</p><ul class=" my-4 ml-4 list-disc text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">chat</code> where bi-directional communication is possible to enable real-time conversation with the bot</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">travel/status</code> where user can subscribe for a stream of updates on different travels, like for example:<div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#7edcda">  destination:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Far</span><span> </span><span style="color:#c0e2a3;font-weight:500">far</span><span> </span><span style="color:#c0e2a3;font-weight:500">away</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  distance:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Beyond</span><span> </span><span style="color:#c0e2a3;font-weight:500">the</span><span> </span><span style="color:#c0e2a3;font-weight:500">seven</span><span> </span><span style="color:#c0e2a3;font-weight:500">mountains</span><span> </span><span style="color:#c0e2a3;font-weight:500">and</span><span> </span><span style="color:#c0e2a3;font-weight:500">seven</span><span> </span><span style="color:#c0e2a3;font-weight:500">forests</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  arrival:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Pretty</span><span> </span><span style="color:#c0e2a3;font-weight:500">soon</span></span></code></pre></div></div></div></div></li></ul><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Except for basic information like the purpose of messages, pub/sub operations, and messages schema, it is good to specify <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">operationId</strong> that is unique across the entire AsyncAPI document and helps to generate human-readable functions&#x27; names.</p><blockquote class=" italic font-sans antialiased text-gray-400 border-l-4 border-gray-400 pl-4 pt-1 pb-1 pr-1 my-4 bg-white"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In the below example, you can see a usage of <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">components</strong> section and schema definitions. I don&#x27;t want to explain those sections in detail here as I did it already in the <a href="/blog/websocket-part2" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Creating AsyncAPI for WebSocket API - Step by Step</a> article.</p></blockquote><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span><span class="text-gray-600 block pl-2 pr-2">13
</span><span class="text-gray-600 block pl-2 pr-2">14
</span><span class="text-gray-600 block pl-2 pr-2">15
</span><span class="text-gray-600 block pl-2 pr-2">16
</span><span class="text-gray-600 block pl-2 pr-2">17
</span><span class="text-gray-600 block pl-2 pr-2">18
</span><span class="text-gray-600 block pl-2 pr-2">19
</span><span class="text-gray-600 block pl-2 pr-2">20
</span><span class="text-gray-600 block pl-2 pr-2">21
</span><span class="text-gray-600 block pl-2 pr-2">22
</span><span class="text-gray-600 block pl-2 pr-2">23
</span><span class="text-gray-600 block pl-2 pr-2">24
</span><span class="text-gray-600 block pl-2 pr-2">25
</span><span class="text-gray-600 block pl-2 pr-2">26
</span><span class="text-gray-600 block pl-2 pr-2">27
</span><span class="text-gray-600 block pl-2 pr-2">28
</span><span class="text-gray-600 block pl-2 pr-2">29
</span><span class="text-gray-600 block pl-2 pr-2">30
</span><span class="text-gray-600 block pl-2 pr-2">31
</span><span class="text-gray-600 block pl-2 pr-2">32
</span><span class="text-gray-600 block pl-2 pr-2">33
</span><span class="text-gray-600 block pl-2 pr-2">34
</span><span class="text-gray-600 block pl-2 pr-2">35
</span><span class="text-gray-600 block pl-2 pr-2">36
</span><span class="text-gray-600 block pl-2 pr-2">37
</span><span class="text-gray-600 block pl-2 pr-2">38
</span><span class="text-gray-600 block pl-2 pr-2">39
</span><span class="text-gray-600 block pl-2 pr-2">40
</span><span class="text-gray-600 block pl-2 pr-2">41
</span><span class="text-gray-600 block pl-2 pr-2">42
</span><span class="text-gray-600 block pl-2 pr-2">43
</span><span class="text-gray-600 block pl-2 pr-2">44
</span><span class="text-gray-600 block pl-2 pr-2">45
</span><span class="text-gray-600 block pl-2 pr-2">46
</span><span class="text-gray-600 block pl-2 pr-2">47
</span><span class="text-gray-600 block pl-2 pr-2">48
</span><span class="text-gray-600 block pl-2 pr-2">49
</span><span class="text-gray-600 block pl-2 pr-2">50
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#797f8c">#</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#797f8c"># Details about all the channels that user can listen to or send to messages</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#797f8c">#</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">channels:</span><span>
</span></span><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/chat:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">chat</span><span> </span><span style="color:#c0e2a3;font-weight:500">messages.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">subChatMessage</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/chatMessage&#x27;</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    publish:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">send</span><span> </span><span style="color:#c0e2a3;font-weight:500">chat</span><span> </span><span style="color:#c0e2a3;font-weight:500">messages.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">pubChatMessage</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/chatMessage&#x27;</span><span>
</span></span><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/travel/status:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">info</span><span> </span><span style="color:#c0e2a3;font-weight:500">status.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">subTravelInfo</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/travelInfo&#x27;</span><span>
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span></span><span style="color:#797f8c">#</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#797f8c"># All reusable parts for readability and staying DRY</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#797f8c">#</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">components:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">  messages:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    chatMessage:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Message</span><span> </span><span style="color:#c0e2a3;font-weight:500">that</span><span> </span><span style="color:#c0e2a3;font-weight:500">you</span><span> </span><span style="color:#c0e2a3;font-weight:500">send</span><span> </span><span style="color:#c0e2a3;font-weight:500">or</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">from</span><span> </span><span style="color:#c0e2a3;font-weight:500">chat</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      payload:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">        type:</span><span> </span><span style="color:#c0e2a3;font-weight:500">string</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    travelInfo:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Message</span><span> </span><span style="color:#c0e2a3;font-weight:500">that</span><span> </span><span style="color:#c0e2a3;font-weight:500">contains</span><span> </span><span style="color:#c0e2a3;font-weight:500">information</span><span> </span><span style="color:#c0e2a3;font-weight:500">about</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">status.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      examples:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">        - payload:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            destination:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Far</span><span> </span><span style="color:#c0e2a3;font-weight:500">far</span><span> </span><span style="color:#c0e2a3;font-weight:500">away</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            distance:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Beyond</span><span> </span><span style="color:#c0e2a3;font-weight:500">the</span><span> </span><span style="color:#c0e2a3;font-weight:500">seven</span><span> </span><span style="color:#c0e2a3;font-weight:500">mountains</span><span> </span><span style="color:#c0e2a3;font-weight:500">and</span><span> </span><span style="color:#c0e2a3;font-weight:500">seven</span><span> </span><span style="color:#c0e2a3;font-weight:500">forests</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            arrival:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Pretty</span><span> </span><span style="color:#c0e2a3;font-weight:500">soon</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      payload:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">        type:</span><span> </span><span style="color:#c0e2a3;font-weight:500">object</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">        properties:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">          destination:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            description:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Name</span><span> </span><span style="color:#c0e2a3;font-weight:500">of</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">destination.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            type:</span><span> </span><span style="color:#c0e2a3;font-weight:500">string</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">          distance:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            description:</span><span> </span><span style="color:#c0e2a3;font-weight:500">How</span><span> </span><span style="color:#c0e2a3;font-weight:500">much</span><span> </span><span style="color:#c0e2a3;font-weight:500">distance</span><span> </span><span style="color:#c0e2a3;font-weight:500">left</span><span> </span><span style="color:#c0e2a3;font-weight:500">to</span><span> </span><span style="color:#c0e2a3;font-weight:500">the</span><span> </span><span style="color:#c0e2a3;font-weight:500">target.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            type:</span><span> </span><span style="color:#c0e2a3;font-weight:500">string</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">          arrival:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            description:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Time</span><span> </span><span style="color:#c0e2a3;font-weight:500">left</span><span> </span><span style="color:#c0e2a3;font-weight:500">to</span><span> </span><span style="color:#c0e2a3;font-weight:500">get</span><span> </span><span style="color:#c0e2a3;font-weight:500">there.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">            type:</span><span> </span><span style="color:#c0e2a3;font-weight:500">string</span></span></code></pre></div></div></div></div><h3 id="final-document" class=" my-4 font-sans antialiased font-medium text-lg">Final document</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">You can see the entire AsyncAPI document for ShrekApp always up to date <a href="https://github.com/derberg/shrekapp-asyncapi-designed/blob/main/asyncapi.yaml" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">here</a></p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The AsyncAPI document I just created is not very complicated as this way it will be easier to understand the generated code. Most important is for you to notice that all information about your application is expressed in the AsyncAPI document, and once you do it, options for the next steps are just endless.</p><h2 id="generate-code" class=" my-4 font-sans antialiased font-medium text-xl">Generate Code</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">It is time now to generate some code that enables you to focus just on the business logic.</p><h3 id="asyncapi-generator" class=" my-4 font-sans antialiased font-medium text-lg">AsyncAPI Generator</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The AsyncAPI Initiative maintains the <a href="https://github.com/asyncapi/generator/" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">AsyncAPI Generator</a>, a tool that enables you to generate anything you want out of an AsyncAPI document. <a href="https://www.asyncapi.com/generator" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Generator</a> provides several features that make it much easier to provide so-called <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">templates</strong>. The template is a standalone project that defines what files should be rendered by the Generator as a final output.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">We have many templates on our <a href="https://github.com/asyncapi/generator#list-of-official-generator-templates" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">list</a><undefined>. Try out the project by following <span role="img" aria-label="backhand index pointing down">ðŸ‘‡</span> instructions:</undefined></p><div class="relative max-w-full mt-8 mx-auto"><div class="mb-4"><span class="text-sm text-gray-500 mr-2">Select a Generator template:</span><select class="form-select h-full py-0 pl-2 pr-8 inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500 shadow-outline-blue"><option selected="" value="@asyncapi/html-template">HTML</option><option value="@asyncapi/markdown-template">Markdown</option><option value="@asyncapi/nodejs-template">Node.js</option><option value="@asyncapi/nodejs-ws-template">Node.js WebSockets</option><option value="@asyncapi/java-spring-cloud-stream-template">Java Spring Cloud Stream</option><option value="@asyncapi/java-spring-template">Java Spring Boot</option><option value="@asyncapi/python-paho-template">Python Paho</option></select></div><div class="shadow-lg relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="text-xs pb-3 pt-0 pl-1"><nav><ul><li class="inline-block border-teal-300 py-1 px-2 mx-px cursor-pointer hover:text-teal-300 text-teal-300 font-bold border-b-2">npm</li><li class="inline-block border-teal-300 py-1 px-2 mx-px cursor-pointer hover:text-teal-300 text-gray-300">Docker</li></ul></nav></div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-sm" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span></code><code class="mr-8"><span class=" pr-8"><span>npm install -g @asyncapi/generator
</span></span><span class=" pr-8"><span></span><span class="hljs-generator-command">ag</span><span class="hljs-generator-command hljs-asyncapi-file"> https://bit.ly/asyncapi</span><span class="hljs-generator-command hljs-asyncapi-file hljs-generator-template"> @asyncapi/html-template </span><span class="hljs-generator-command hljs-asyncapi-file hljs-generator-template hljs-generator-param">-o example</span></span></code></pre></div></div></div></div><h3 id="generate-server-and-client" class=" my-4 font-sans antialiased font-medium text-lg">Generate Server and Client</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">This article focuses on WebSocket therefore, I use our <a href="https://github.com/asyncapi/nodejs-ws-template" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Node.js WebSocket template</a> that is capable of generating server for WebSocket API and also a client that is aware of available channels.</p><ol class=" my-4 ml-4 list-decimal text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Create a new directory where you will work on the project:<div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>mkdir shrekapp &amp;&amp; </span><span style="color:#7edcda">cd</span><span> shrekapp</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Trigger generation using the template:<div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>ag https://raw.githubusercontent.com/derberg/shrekapp-asyncapi-designed/main/asyncapi.yaml @asyncapi/nodejs-ws-template -o myapp -p server=swamp</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Access generated folder and list all files from the directory. Notice that Node.js application is generated:<div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span style="color:#7edcda">cd</span><span> myapp &amp;&amp; ls</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Install application dependencies<div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>npm i</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Start the application<div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>npm start</span></span></code></pre></div></div></div></div></li></ol><p class=" my-4 text-gray-700 font-normal font-sans antialiased">That is it. The basics are done. The application is ready, and all the basic logic is there. You can already interact with the application on <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">localhost</strong> on port <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">80</strong>. Now you need a client able to communicate with WebSocket protocol. For now, we will not explore the generated client.</p><ol class=" my-4 ml-4 list-decimal text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Get <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">websocat</strong> (curl-like tool for WebSocket) by following <a href="https://github.com/vi/websocat#installation" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">these instructions</a></p></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Connect to one of the channels and notice that the server sent you a message to respond to established connection.</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span></code><code class="mr-8"><span class=" pr-8"><span>websocat ws://localhost/travel/status
</span></span><span class=" pr-8">
</span><span class=" pr-8">Message from the server: Implement here your business logic that sends messages to a client after it connects.
</span></code></pre></div></div></div></div></li></ol><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Logs in the running server should also indicate a new connection with the server:</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span></code><code class="mr-8"><span class=" pr-8"><span>Listening on port 80
</span></span><span class=" pr-8">/travel/status client connected.
</span></code></pre></div></div></div></div><h2 id="code-walkthrough" class=" my-4 font-sans antialiased font-medium text-xl">Code Walkthrough</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Before writing some code, let&#x27;s first go through the generated code:</p><ul class=" my-4 ml-4 list-disc text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased">For the generated server, we need to look into <code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">src/api/routes.js</code> and <code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">src/api/services</code></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">For generated client, everything is in the <code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">index.html</code></li></ul><h3 id="server-code" class=" my-4 font-sans antialiased font-medium text-lg">Server Code</h3><h4 id="router" class=" my-4 font-sans antialiased font-medium text-lg text-gray-500">Router</h4><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Basing on the information provided in the AsyncAPI document about available channels, in the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">src/api/routes.js</strong> the following routes are generated:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span><span class="text-gray-600 block pl-2 pr-2">13
</span><span class="text-gray-600 block pl-2 pr-2">14
</span><span class="text-gray-600 block pl-2 pr-2">15
</span><span class="text-gray-600 block pl-2 pr-2">16
</span><span class="text-gray-600 block pl-2 pr-2">17
</span><span class="text-gray-600 block pl-2 pr-2">18
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#64a0dc">const</span><span> { subChatMessage, pubChatMessage } = </span><span style="color:#7edcda">require</span><span>(</span><span style="color:#c0e2a3;font-weight:500">&#x27;./services/chat&#x27;</span><span>);
</span></span><span class=" pr-8"><span></span><span style="color:#64a0dc">const</span><span> { subTravelInfo } = </span><span style="color:#7edcda">require</span><span>(</span><span style="color:#c0e2a3;font-weight:500">&#x27;./services/travel-status&#x27;</span><span>);
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span>router.ws(</span><span style="color:#c0e2a3;font-weight:500">&#x27;/chat&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (ws, req) =&gt; {
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> path = pathParser(req.path);
</span></span><span class=" pr-8"><span>  </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> client connected.`</span><span>);
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">await</span><span> subChatMessage(ws);
</span></span><span class=" pr-8"><span>  ws.on(</span><span style="color:#c0e2a3;font-weight:500">&#x27;message&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (msg) =&gt; {
</span></span><span class=" pr-8"><span>    </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> message was received:`</span><span>);
</span></span><span class=" pr-8"><span>    </span><span style="color:#7edcda">console</span><span>.log(util.inspect(msg, { </span><span style="color:#7edcda">depth</span><span>: </span><span style="color:#64a0dc">null</span><span>, </span><span style="color:#7edcda">colors</span><span>: </span><span style="color:#64a0dc">true</span><span> }));
</span></span><span class=" pr-8"><span>    </span><span style="color:#64a0dc">await</span><span> pubChatMessage(ws, { </span><span style="color:#7edcda">message</span><span>: msg, path, </span><span style="color:#7edcda">query</span><span>: req.query });
</span></span><span class=" pr-8">  });
</span><span class=" pr-8">});
</span><span class=" pr-8"><span>router.ws(</span><span style="color:#c0e2a3;font-weight:500">&#x27;/travel/status&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (ws, req) =&gt; {
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> path = pathParser(req.path);
</span></span><span class=" pr-8"><span>  </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> client connected.`</span><span>);
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">await</span><span> subTravelInfo(ws);
</span></span><span class=" pr-8">});
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In the case of this particular template, routes are handled by <a href="https://expressjs.com/" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Express framework</a> and <a href="https://github.com/HenningM/express-ws" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">express-ws</a> middleware.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">First let&#x27;s have a look at <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">/travel/status</strong> route:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span></code><code class="mr-8"><span class=" pr-8"><span>router.ws(</span><span style="color:#c0e2a3;font-weight:500">&#x27;/travel/status&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (ws, req) =&gt; {
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> path = pathParser(req.path);
</span></span><span class=" pr-8"><span>  </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> client connected.`</span><span>);
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">await</span><span> subTravelInfo(ws);
</span></span><span class=" pr-8">});
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Once the client establishes connection with the server, generated code invokes a function called <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subTravelInfo</strong>. Now look again at the AsyncAPI document:</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span></code><code class="mr-8"><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/travel/status:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">info</span><span> </span><span style="color:#c0e2a3;font-weight:500">status.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">subTravelInfo</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/travelInfo&#x27;</span></span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The name of the function maps to the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">operationId</strong>. The <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">/travel/status</strong> channel supports only <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subscribe</strong> operation which means that client can only connect to the channel to listen for the messages, no messages are accepted. This is why the generated router doesn&#x27;t react to any message sent to the channel. As oposite to the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">/chat</strong> channel:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span></code><code class="mr-8"><span class=" pr-8"><span>router.ws(</span><span style="color:#c0e2a3;font-weight:500">&#x27;/chat&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (ws, req) =&gt; {
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> path = pathParser(req.path);
</span></span><span class=" pr-8"><span>  </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> client connected.`</span><span>);
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">await</span><span> subChatMessage(ws);
</span></span><span class=" pr-8"><span>  ws.on(</span><span style="color:#c0e2a3;font-weight:500">&#x27;message&#x27;</span><span>, </span><span style="color:#64a0dc">async</span><span> (msg) =&gt; {
</span></span><span class=" pr-8"><span>    </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`</span><span style="color:#d6deeb;font-weight:500">${yellow(path)}</span><span style="color:#c0e2a3;font-weight:500"> message was received:`</span><span>);
</span></span><span class=" pr-8"><span>    </span><span style="color:#7edcda">console</span><span>.log(util.inspect(msg, { </span><span style="color:#7edcda">depth</span><span>: </span><span style="color:#64a0dc">null</span><span>, </span><span style="color:#7edcda">colors</span><span>: </span><span style="color:#64a0dc">true</span><span> }));
</span></span><span class=" pr-8"><span>    </span><span style="color:#64a0dc">await</span><span> pubChatMessage(ws, { </span><span style="color:#7edcda">message</span><span>: msg, path, </span><span style="color:#7edcda">query</span><span>: req.query });
</span></span><span class=" pr-8">  });
</span><span class=" pr-8">});
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subChatMessage</strong> function is invoked when client connects with the server. There is also a message listener generated that invokes <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">pubChatMessage</strong> function whenever a message is sent from the client. Now look again at the AsyncAPI document:</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span></code><code class="mr-8"><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/chat:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">chat</span><span> </span><span style="color:#c0e2a3;font-weight:500">messages.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">subChatMessage</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/chatMessage&#x27;</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    publish:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">send</span><span> </span><span style="color:#c0e2a3;font-weight:500">chat</span><span> </span><span style="color:#c0e2a3;font-weight:500">messages.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">pubChatMessage</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/chatMessage&#x27;</span></span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The client can not only listen to the messages incoming from <code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">/chat</code> channel but, in this case, can also send messages. This way, there can be bi-directional communication established between the client and the chatbot.</p><h4 id="services" class=" my-4 font-sans antialiased font-medium text-lg text-gray-500">Services</h4><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Functions like, for example, <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">pubChatMessage</strong> are generated in the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">services</strong> directory. All functions for single channel go into individual file. Have a look at <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">src/api/services/travel-status.js</strong> file:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#64a0dc">const</span><span> service = </span><span style="color:#7edcda">module</span><span>.exports = {};
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span></span><span style="color:#797f8c">/**
</span></span><span class=" pr-8" style="color:#797f8c"> * Client can receive travel info status.
</span><span class=" pr-8" style="color:#797f8c"> * @param {object} ws WebSocket connection.
</span><span class=" pr-8"><span style="color:#797f8c"> */</span><span>
</span></span><span class=" pr-8"><span>service.subTravelInfo = </span><span style="color:#64a0dc">async</span><span> (ws) =&gt; {
</span></span><span class=" pr-8"><span>  ws.send(</span><span style="color:#c0e2a3;font-weight:500">&#x27;Message from the server: Implement here your business logic that sends messages to a client after it connects.&#x27;</span><span>);
</span></span><span class=" pr-8">};
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">As you can see, you are ready to provide your business logic by replacing the generated one:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>ws.send(</span><span style="color:#c0e2a3;font-weight:500">&#x27;Message from the server: Implement here your business logic that sends messages to a client after it connects.&#x27;</span><span>);</span></span></code></pre></div></div></div></div><h3 id="client-code" class=" my-4 font-sans antialiased font-medium text-lg">Client Code</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The Node.js WebSocket template that I use for this article also generates <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">index.html</strong> file to showcase that client generation is also possible using AsyncAPI document. As I mentioned in the beginning, with AsyncAPI and the AsyncAPI Generator, you can generate whatever you want.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">index.html</strong> contains a simple API that you can call from the browser&#x27;s console to talk to the WebSocket API. Open the file in the browser and play with the API:</p><figure><img class="w-full inline-block" src="/img/posts/websocket-part3/client.webp"/></figure><h2 id="add-business-logic" class=" my-4 font-sans antialiased font-medium text-xl">Add Business Logic</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The Business logic goes only to generated services.</p><h3 id="add-travel-status-updates" class=" my-4 font-sans antialiased font-medium text-lg">Add Travel Status Updates</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I don&#x27;t have here any real travel status updates. I add some dummy data that are sent to the client every 1s, 100 times.</p><ol class=" my-4 ml-4 list-decimal text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Add <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">dummy-json</strong> that makes it easier to provide mock data. I add it only to make sure the code is not overcomplicated</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>npm i --save dummy-json</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Imported the package in the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">src/api/services/travel-status.js</strong> file:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span style="color:#64a0dc">const</span><span> dummyjson = </span><span style="color:#7edcda">require</span><span>(</span><span style="color:#c0e2a3;font-weight:500">&#x27;dummy-json&#x27;</span><span>);</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Modify <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subTravelInfo</strong> from the same file to send mock data to the client with <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">ws.send()</strong> function:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span><span class="text-gray-600 block pl-2 pr-2">13
</span><span class="text-gray-600 block pl-2 pr-2">14
</span><span class="text-gray-600 block pl-2 pr-2">15
</span><span class="text-gray-600 block pl-2 pr-2">16
</span><span class="text-gray-600 block pl-2 pr-2">17
</span></code><code class="mr-8"><span class=" pr-8"><span>service.subTravelInfo = </span><span style="color:#64a0dc">async</span><span> (ws) =&gt; {
</span></span><span class=" pr-8"><span>  (</span><span style="color:#64a0dc">function</span><span style="color:#74e287"> </span><span style="color:#7edcda">myLoop</span><span style="color:#74e287"> (</span><span style="color:#d6deeb">i</span><span style="color:#74e287">) </span><span>{
</span></span><span class=" pr-8"><span>    setTimeout(</span><span style="color:#d6deeb">()</span><span style="color:#74e287"> =&gt;</span><span> {
</span></span><span class=" pr-8">      ws.send(generateResponse());
</span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">if</span><span> (--i) myLoop(i);
</span></span><span class=" pr-8"><span>    }, </span><span style="color:#d8da68">1000</span><span>);
</span></span><span class=" pr-8"><span>  }(</span><span style="color:#d8da68">100</span><span>));  
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">function</span><span style="color:#74e287"> </span><span style="color:#7edcda">generateResponse</span><span style="color:#74e287">(</span><span style="color:#74e287">) </span><span>{
</span></span><span class=" pr-8"><span>    </span><span style="color:#64a0dc">const</span><span> template = </span><span style="color:#c0e2a3;font-weight:500">`{
</span></span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">      &quot;destination&quot;: &quot;{{city}}&quot;,
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">      &quot;arrival&quot;: &quot;{{int 2 6}}h&quot;,
</span><span class=" pr-8" style="color:#c0e2a3;font-weight:500">      &quot;distance&quot;: &quot;{{int 18 65}}km&quot;
</span><span class=" pr-8"><span style="color:#c0e2a3;font-weight:500">    }`</span><span>;
</span></span><span class=" pr-8"><span>    </span><span style="color:#64a0dc">return</span><span> dummyjson.parse(template);
</span></span><span class=" pr-8">  }
</span><span class=" pr-8">};
</span></code></pre></div></div></div></div></li></ol><p class=" my-4 text-gray-700 font-normal font-sans antialiased">This is it. Now restart the server and check with previously installed <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">websocat</strong> if after connecting to <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">travel/status</strong> channel you are now regularly receiving a stream of messages:</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span></code><code class="mr-8"><span class=" pr-8"><span>websocat ws://localhost/travel/status
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Woodville&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;4h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;60km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Denver&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;3h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;60km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Fargo&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;3h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;42km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Exeter&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;2h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;62km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Bradford&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;2h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;55km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Toronto&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;6h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;28km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Durham&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;5h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;59km&quot;</span><span>     }
</span></span><span class=" pr-8"><span>{       </span><span style="color:#c0e2a3;font-weight:500">&quot;destination&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;Canterbury&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;arrival&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;4h&quot;</span><span>,       </span><span style="color:#c0e2a3;font-weight:500">&quot;distance&quot;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">&quot;50km&quot;</span><span>     }</span></span></code></pre></div></div></div></div><h3 id="add-chatbot-communication" class=" my-4 font-sans antialiased font-medium text-lg">Add ChatBot Communication</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I chose Wit.ai as a platform that:</p><ul class=" my-4 ml-4 list-disc text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Makes is super easy to train the bot</li><li class=" my-3 text-gray-700 font-normal font-sans antialiased">Gives me access to API that enables integration with custom services, like the one that we just generated</li></ul><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I encourage you to <a href="https://wit.ai/docs/quickstart" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">give it a try</a> as it is pretty easy to use if it is your first time with ChatBots. It was my first time. </p><ol class=" my-4 ml-4 list-decimal text-gray-700 font-normal font-sans antialiased"><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">To make it easier to talk to Wit.ai API I use <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">node-fetch</strong> package:</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span>npm i --save node-fetch</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Imported the package in the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">src/api/services/chat.js</strong> file:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class="absolute top-0 bottom-0 right-0 pl-5 pr-2 bg-code-editor-dark z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-3 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="mr-8"><span class=" pr-8"><span style="color:#64a0dc">const</span><span> fetch = </span><span style="color:#7edcda">require</span><span>(</span><span style="color:#c0e2a3;font-weight:500">&#x27;node-fetch&#x27;</span><span>);</span></span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Modify <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subChatMessage</strong> from the same file to send to the client message that connection is working:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span></code><code class="mr-8"><span class=" pr-8"><span>service.subChatMessage = </span><span style="color:#64a0dc">async</span><span> (ws) =&gt; {
</span></span><span class=" pr-8"><span>  ws.send(</span><span style="color:#c0e2a3;font-weight:500">&#x27;Connection with Shrek established&#x27;</span><span>);
</span></span><span class=" pr-8">};
</span></code></pre></div></div></div></div></li><li class=" my-3 text-gray-700 font-normal font-sans antialiased"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Modify <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">pubChatMessage</strong> that is invoked when message from the client gets to the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">/chat</strong> channel:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span><span class="text-gray-600 block pl-2 pr-2">13
</span><span class="text-gray-600 block pl-2 pr-2">14
</span><span class="text-gray-600 block pl-2 pr-2">15
</span><span class="text-gray-600 block pl-2 pr-2">16
</span><span class="text-gray-600 block pl-2 pr-2">17
</span><span class="text-gray-600 block pl-2 pr-2">18
</span><span class="text-gray-600 block pl-2 pr-2">19
</span><span class="text-gray-600 block pl-2 pr-2">20
</span><span class="text-gray-600 block pl-2 pr-2">21
</span><span class="text-gray-600 block pl-2 pr-2">22
</span><span class="text-gray-600 block pl-2 pr-2">23
</span><span class="text-gray-600 block pl-2 pr-2">24
</span><span class="text-gray-600 block pl-2 pr-2">25
</span><span class="text-gray-600 block pl-2 pr-2">26
</span><span class="text-gray-600 block pl-2 pr-2">27
</span><span class="text-gray-600 block pl-2 pr-2">28
</span><span class="text-gray-600 block pl-2 pr-2">29
</span></code><code class="mr-8"><span class=" pr-8"><span>service.pubChatMessage = </span><span style="color:#64a0dc">async</span><span> (ws, { message, path, query }) =&gt; {
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> messageToShrek = message ? </span><span style="color:#7edcda">encodeURIComponent</span><span>(message) : </span><span style="color:#c0e2a3;font-weight:500">&#x27;&#x27;</span><span>;
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">const</span><span> defaultAnswer = </span><span style="color:#c0e2a3;font-weight:500">&#x27;Shrek is out sorry. He\&#x27;s busy rescuing the princess.&#x27;</span><span>;
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">let</span><span> shrekAnswer = defaultAnswer;
</span></span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">let</span><span> botAnswer;
</span></span><span class=" pr-8">
</span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">try</span><span> {
</span></span><span class=" pr-8"><span>      botAnswer = </span><span style="color:#64a0dc">await</span><span> fetch(</span><span style="color:#c0e2a3;font-weight:500">`https://api.wit.ai/message?q=</span><span style="color:#d6deeb;font-weight:500">${messageToShrek}</span><span style="color:#c0e2a3;font-weight:500">`</span><span>, {
</span></span><span class=" pr-8"><span>          </span><span style="color:#7edcda">headers</span><span>: { </span><span style="color:#c0e2a3;font-weight:500">&#x27;Authorization&#x27;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">`Bearer </span><span style="color:#d6deeb;font-weight:500">${process.env.CHATBOT_TOKEN}</span><span style="color:#c0e2a3;font-weight:500">`</span><span> }
</span></span><span class=" pr-8">      });
</span><span class=" pr-8"><span>  } </span><span style="color:#64a0dc">catch</span><span> (e) {
</span></span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">throw</span><span> </span><span style="color:#64a0dc">new</span><span> </span><span style="color:#7edcda">Error</span><span>(</span><span style="color:#c0e2a3;font-weight:500">`Having issues communicating with the bot: </span><span style="color:#d6deeb;font-weight:500">${e}</span><span style="color:#c0e2a3;font-weight:500">`</span><span>);
</span></span><span class=" pr-8">  }
</span><span class=" pr-8">
</span><span class=" pr-8"><span>  </span><span style="color:#64a0dc">if</span><span> (botAnswer) {
</span></span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">const</span><span> wrongQuestionAnswer = </span><span style="color:#c0e2a3;font-weight:500">&#x27;Is it you Donkey!? Ask a better question!&#x27;</span><span>;
</span></span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">const</span><span> answerObject = </span><span style="color:#64a0dc">await</span><span> botAnswer.json();
</span></span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">let</span><span> firstTraitValue;
</span></span><span class=" pr-8">      
</span><span class=" pr-8"><span>      </span><span style="color:#64a0dc">for</span><span> (</span><span style="color:#64a0dc">const</span><span> [, v] </span><span style="color:#64a0dc">of</span><span> </span><span style="color:#7edcda">Object</span><span>.entries(answerObject.traits)) {
</span></span><span class=" pr-8"><span>        firstTraitValue = v[</span><span style="color:#d8da68">0</span><span>].value;
</span></span><span class=" pr-8"><span>        </span><span style="color:#64a0dc">break</span><span>;
</span></span><span class=" pr-8">      }
</span><span class=" pr-8">
</span><span class=" pr-8">      shrekAnswer = firstTraitValue ? firstTraitValue : wrongQuestionAnswer;
</span><span class=" pr-8">  }
</span><span class=" pr-8"><span>  </span><span style="color:#7edcda">console</span><span>.log(</span><span style="color:#c0e2a3;font-weight:500">`Answered with: </span><span style="color:#d6deeb;font-weight:500">${shrekAnswer}</span><span style="color:#c0e2a3;font-weight:500">`</span><span>)
</span></span><span class=" pr-8">  ws.send(shrekAnswer);
</span><span class=" pr-8">};
</span></code></pre></div></div></div></div></li></ol><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The most important part of this code is when the communication with the Wit.ai platform happens to send a message and get a response:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span></code><code class="mr-8"><span class=" pr-8"><span>      botAnswer = </span><span style="color:#64a0dc">await</span><span> fetch(</span><span style="color:#c0e2a3;font-weight:500">`https://api.wit.ai/message?q=</span><span style="color:#d6deeb;font-weight:500">${messageToShrek}</span><span style="color:#c0e2a3;font-weight:500">`</span><span>, {
</span></span><span class=" pr-8"><span>          </span><span style="color:#7edcda">headers</span><span>: { </span><span style="color:#c0e2a3;font-weight:500">&#x27;Authorization&#x27;</span><span>: </span><span style="color:#c0e2a3;font-weight:500">`Bearer </span><span style="color:#d6deeb;font-weight:500">${process.env.CHATBOT_TOKEN}</span><span style="color:#c0e2a3;font-weight:500">`</span><span> }
</span></span><span class=" pr-8">      });
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">This is it. Now restart the server and check with previously installed <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">websocat</strong> if after connecting to <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">chat</strong> channel you can send messages to chatbot and receive answers. You need to start the server with <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">CHATBOT_TOKEN</strong> environment variable with the token: <code class=" px-1 py-0.5 bg-primary-700 text-white rounded font-mono text-sm">CHATBOT_TOKEN=your-token npm start</code>. I cannot give you my token, sorry, you have to get yours from <a href="https://www.wit.ai" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Wit.ai</a> and train your chatbot:</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span></code><code class="mr-8"><span class=" pr-8"><span>websocat ws://localhost/chat
</span></span><span class=" pr-8">
</span><span class=" pr-8">Connection with Shrek established
</span><span class=" pr-8">
</span><span class=" pr-8">Me: Hi Shrek
</span><span class=" pr-8"><span>Shrek: hey, </span><span style="color:#64a0dc">do</span><span> you know ogrs have layers?
</span></span><span class=" pr-8">Me: Interesting
</span><span class=" pr-8">Shrek: are you mocking me?
</span><span class=" pr-8">Me: Why would I? I like you
</span><span class=" pr-8">Shrek: Is it you Donkey!? Ask a better question!
</span><span class=" pr-8">Me: No, not a donkey
</span><span class=" pr-8">Shrek: good
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">You can also see logs on the server-side:</p><div class=" my-8"><div class="language-bash rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span><span class="text-gray-600 block pl-2 pr-2">7
</span><span class="text-gray-600 block pl-2 pr-2">8
</span><span class="text-gray-600 block pl-2 pr-2">9
</span><span class="text-gray-600 block pl-2 pr-2">10
</span><span class="text-gray-600 block pl-2 pr-2">11
</span><span class="text-gray-600 block pl-2 pr-2">12
</span><span class="text-gray-600 block pl-2 pr-2">13
</span><span class="text-gray-600 block pl-2 pr-2">14
</span></code><code class="mr-8"><span class=" pr-8"><span>Listening on port 80
</span></span><span class=" pr-8">/chat client connected.
</span><span class=" pr-8">/chat message was received:
</span><span class=" pr-8"><span></span><span style="color:#c0e2a3;font-weight:500">&#x27;Hi Shrek\n&#x27;</span><span>
</span></span><span class=" pr-8"><span>Answered with: hey, </span><span style="color:#64a0dc">do</span><span> you know ogrs have layers?
</span></span><span class=" pr-8">/chat message was received:
</span><span class=" pr-8"><span></span><span style="color:#c0e2a3;font-weight:500">&#x27;Interesting\n&#x27;</span><span>
</span></span><span class=" pr-8">Answered with: are you mocking me?
</span><span class=" pr-8">/chat message was received:
</span><span class=" pr-8"><span></span><span style="color:#c0e2a3;font-weight:500">&#x27;Why would I? I like you\n&#x27;</span><span>
</span></span><span class=" pr-8">Answered with: Is it you Donkey!? Ask a better question!
</span><span class=" pr-8">/chat message was received:
</span><span class=" pr-8"><span></span><span style="color:#c0e2a3;font-weight:500">&#x27;No, not a donkey\n&#x27;</span><span>
</span></span><span class=" pr-8">Answered with: good
</span></code></pre></div></div></div></div><h2 id="summary" class=" my-4 font-sans antialiased font-medium text-xl">Summary</h2><p class=" my-4 text-gray-700 font-normal font-sans antialiased">If you do not want to go through all the steps of getting the generated code, you can directly use <a href="https://github.com/derberg/shrekapp-asyncapi-designed" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">this project</a>. It contains everything mentioned in this article.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">As you could see, the only coding part was just business implementation details, and the rest was generated. When I worked on this article, I focused first on the API. My main goal was to write the AsyncAPI document first, and the rest was easy.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Are you convinced now that API-first is better than code-first?</p><figure class="text-center"><img class="w-1/2 inline-block" src="/img/posts/websocket-part3/meme-redbuttons.webp"/></figure><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I&#x27;m an API-first person. I can go on and give you many arguments that support my view.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I won&#x27;t do it.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Instead, I will honestly tell you what the problems are related to API-first and code generation. You judge what is the path you want to take.</p><h3 id="asyncapi-20-limitations" class=" my-4 font-sans antialiased font-medium text-lg">AsyncAPI 2.0 Limitations</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">As I mention in this article and the previous ones on WebSocket, you write AsyncAPI document for your application from a client perspective. When you start designing your API, you ask yourself questions from the user&#x27;s perspective.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Don&#x27;t get me wrong; I&#x27;m not saying that taking user perspective is wrong. It makes sense but also confusing for many. I recommend joining <a href="https://github.com/asyncapi/spec/issues/520" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">this thread</a> for more details.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Confusion between <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subscribe</strong> and <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">publish</strong> is not the only problem. Once you understand that your application that publishes events must describe it as subscribe operation, the rest is trivial.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The real problem is with code generation. You describe the application from a user perspective, so client code generation is easy. What about generating code for your server? Have a look again at the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">/travel/status</strong> channel from ShrekApp:</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span></code><code class="mr-8"><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/travel/status:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">Client</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">receive</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">info</span><span> </span><span style="color:#c0e2a3;font-weight:500">status.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">subTravelInfo</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/travelInfo&#x27;</span></span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I had to try hard to make sure the <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">summary</strong> and <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">operationId</strong> are as neutral as possible. My first version looked like this:</p><div class=" my-8"><div class="language-yml rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span></code><code class="mr-8"><span class=" pr-8"><span>  </span><span style="color:#c0e2a3;font-weight:500">/travel/status:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">    subscribe:</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      summary:</span><span> </span><span style="color:#c0e2a3;font-weight:500">You</span><span> </span><span style="color:#c0e2a3;font-weight:500">can</span><span> </span><span style="color:#c0e2a3;font-weight:500">listen</span><span> </span><span style="color:#c0e2a3;font-weight:500">to</span><span> </span><span style="color:#c0e2a3;font-weight:500">travel</span><span> </span><span style="color:#c0e2a3;font-weight:500">info</span><span> </span><span style="color:#c0e2a3;font-weight:500">status.</span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      operationId:</span><span> </span><span style="color:#c0e2a3;font-weight:500">onTravelInfo</span><span> </span><span style="color:#797f8c">#client code perspective, generated client reacts &quot;onTravelInfo&quot; incomming message </span><span>
</span></span><span class=" pr-8"><span></span><span style="color:#7edcda">      message:</span><span>
</span></span><span class=" pr-8"><span>        </span><span style="color:#c0e2a3;font-weight:500">$ref:</span><span> </span><span style="color:#c0e2a3;font-weight:500">&#x27;#/components/messages/travelInfo&#x27;</span></span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Then in <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">src/api/services/travel-status.js</strong> file, I would have <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">onTravelInfo</strong> instead of <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">subTravelInfo</strong> with the following jsdoc:</p><div class=" my-8"><div class="language-js rounded relative max-w-full rounded overflow-y-hidden overflow-x-auto py-2 bg-code-editor-dark z-10"><div class=" z-10"><button class="absolute bg-code-editor-dark z-50 text-xs text-gray-500 right-2 top-1 cursor-pointer hover:text-gray-300 focus:outline-none" title="Copy to clipboard"><span class="inline-block pt-1"><svg class="inline-block w-4 h-4 -mt-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M15.6 2l-1.2 3H5.6L4.4 2C3.629 2 3 2.629 3 3.4v15.2c0 .77.629 1.4 1.399 1.4h11.2c.77 0 1.4-.631 1.4-1.4V3.4C17 2.629 16.369 2 15.6 2zm-2 2l.9-2h-2.181L11.6 0H8.4l-.72 2H5.5l.899 2H13.6z"></path></svg></span></button></div><div><div class="pr-8 relative overflow-y-auto"><pre class="pt-px pb-0 text-sm font-medium font-ligatures-contextual ml-0 text-xs" style="display:inline-block;background:#252f3f;color:#d6deeb"><code class="pl-2 float-left left-0 sticky bg-code-editor-dark"><span class="text-gray-600 block pl-2 pr-2">1
</span><span class="text-gray-600 block pl-2 pr-2">2
</span><span class="text-gray-600 block pl-2 pr-2">3
</span><span class="text-gray-600 block pl-2 pr-2">4
</span><span class="text-gray-600 block pl-2 pr-2">5
</span><span class="text-gray-600 block pl-2 pr-2">6
</span></code><code class="mr-8"><span class=" pr-8"><span style="color:#797f8c">/**
</span></span><span class=" pr-8" style="color:#797f8c"> * You can listen to travel info status.
</span><span class=" pr-8" style="color:#797f8c"> * @param {object} ws WebSocket connection.
</span><span class=" pr-8"><span style="color:#797f8c"> */</span><span>
</span></span><span class=" pr-8"><span>service.onTravelInfo = </span><span style="color:#64a0dc">async</span><span> (ws) =&gt; {
</span></span><span class=" pr-8">...
</span></code></pre></div></div></div></div><p class=" my-4 text-gray-700 font-normal font-sans antialiased">This is a function responsible for sending messages to the Client once it connects with a given channel. Function name like <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">onTravelInfo</strong> is misleading, not to mention the generated code description.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">I chose neutral descriptions. They are acceptable, I think, but not when it comes to user-facing documentation. Every technical writer will tell you that the best docs are the ones that are directed to a reader. You don&#x27;t write &quot;what user can do with the API&quot; but &quot;what you can do with the API&quot;.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Therefore, all descriptions and even things like <strong class=" my-4 text-gray-700 font-semibold font-sans antialiased">operationId</strong> should have two versions to satisfy both docs and code depending on the perspective. Otherwise, you need to make a sacrifice. You either make the developer that maintains the code happy or the technical writer that maintains docs happy.</p><blockquote class=" italic font-sans antialiased text-gray-400 border-l-4 border-gray-400 pl-4 pt-1 pb-1 pr-1 my-4 bg-white"><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Join the discussion around <a href="https://github.com/asyncapi/spec/issues/538" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">operationId</a>.</p></blockquote><h3 id="keeping-asyncapi-in-sync-with-code" class=" my-4 font-sans antialiased font-medium text-lg">Keeping AsyncAPI in Sync With Code</h3><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In this article, I generated a server that was easy to extend, to showcase AsyncAPI capabilities. Using such projects is a way for building prototypes and quickly design architectures. You can even scaffold a server that later you can tune and use on production.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">You did your work, you did API-first.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">What happens later? I mean later during further development of the application.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Let&#x27;s say you add a new channel to the server or modify the name of the old channel. </p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Where do you do it? AsyncAPI document or the code? You need to do it manually in both. You need to add a channel to the AsyncAPI document and add implementation for the channel in the code. You enter the land where your AsyncAPI document describes something different from your code at some point in time. You cannot regenerate the project with the template you used in the beginning, as your custom logic will be lost.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">The AsyncAPI Generator provides support for Git. If you have a Git repository and unstaged files, the Generator warns you that your changes may be lost. Git support is definitely helpful. You can try code regeneration, but you need to review changes and manually ignore overrides after that. </p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">It can be a cumbersome process, but you maintain sync between the AsyncAPI document and the code. There is no place for automation, though.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">There must be a way to solve these challenges. Maybe some kind of markers.  One could use them in code to indicate that the generator must ignore a given part of the code. Another helpful solution could be a way to specify what template files should be ignored during generation. For example, regenerate only models built from messages&#x27; schemas. We need to figure it out.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">Don&#x27;t give up, though. Technical challenges are not a good excuse for avoiding the API-first approach.</p><figure class="text-center"><img class="w-1/2 inline-block" src="/img/posts/websocket-part3/meme-starwars.webp"/></figure><p class=" my-4 text-gray-700 font-normal font-sans antialiased">In my opinion, specification limitations and gaps in tooling support should not block you from choosing an API-first direction. The benefits are too big to resign that easily. Just join us and let us find solutions together. We want to help solve all those issues, but we just need some help from you too.</p><p class=" my-4 text-gray-700 font-normal font-sans antialiased">That would be it. Thanks for staying with me until the end. Don&#x27;t forget to read my previous articles on AsyncAPI spec and WebSocket protocol. Share your feedback and connect with the AsyncAPI community in our <a href="https://www.asyncapi.com/slack-invite/" class="text-primary-600 font-medium hover:text-primary-500 font-sans antialiased">Slack workspace</a>.</p></article></main></div><div class="bg-white mt-12"><div class="bg-primary-900 py-12"><div class="max-w-screen-xl block   px-4 sm:px-6 lg:px-8 mx-auto block   px-4 sm:px-6 lg:px-8"><div class="p-8"><h3 class="text-primary-200 text-lg font-bold">Subscribe to our newsletter to receive news about AsyncAPI.</h3><p class="text-gray-400 mt-2 text-sm">We respect your inbox. No spam, promise âœŒï¸</p><form class="mt-4 md:flex" data-netlify="true"><input type="hidden" name="form-name" value="form 2"/><input type="hidden" name="type"/><input type="text" name="name" placeholder="Your name" class="form-input block w-full sm:text-sm sm:leading-5 md:mr-2 md:mt-0 md:flex-1" required=""/><input type="email" name="email" placeholder="Your email" class="form-input block w-full mt-2 sm:text-sm sm:leading-5 md:mr-2 md:mt-0 md:flex-1" required=""/><button type="submit" class="bg-primary-500 hover:bg-primary-400 text-white hover:text-white shadow-md hover:shadow-lg transition-all duration-500 ease-in-out rounded px-4 py-3 text-white w-full mt-2 md:mr-2 md:mt-0 md:flex-1"><span class="inline-block">Subscribe</span></button></form></div></div></div><div class="max-w-screen-xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8"><nav class="-mx-5 -my-2 flex flex-wrap justify-center"><div class="px-5 py-2"><a href="/about" class="text-base leading-6 text-gray-500 hover:text-gray-900">About</a></div><div class="px-5 py-2"><a href="/blog" class="text-base leading-6 text-gray-500 hover:text-gray-900">Blog</a></div><div class="px-5 py-2"><a href="https://asyncapi.threadless.com" target="_blank" class="text-base leading-6 text-gray-500 hover:text-gray-900">Shop</a></div><div class="px-5 py-2"><a href="/jobs" class="text-base leading-6 text-gray-500 hover:text-gray-900">Jobs</a></div><div class="px-5 py-2"><a href="mailto:press@asyncapi.io" class="text-base leading-6 text-gray-500 hover:text-gray-900">Press</a></div></nav><div class="mt-8 flex justify-center"><a href="https://twitter.com/AsyncAPISpec" target="_blank" class="text-gray-400 hover:text-blue-500"><span class="sr-only">Twitter</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path></svg></a><a href="https://github.com/asyncapi" target="_blank" class="ml-6 text-gray-400 hover:text-gray-500"><span class="sr-only">GitHub</span><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg></a><a href="https://linkedin.com/company/asyncapi" target="_blank" class="ml-6 text-gray-400 hover:text-blue-500"><span class="sr-only">LinkedIn</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 21 22" enable-background="new 0 0 21 22" fill="currentColor" class="h-6 w-6"><path d="M5,3c0,1.1-0.7,2-2,2C1.8,5,1,4.1,1,3.1C1,2,1.8,1,3,1S5,1.9,5,3z M1,19h4V6H1V19z M14.6,6.2c-2.1,0-3.3,1.2-3.8,2h-0.1 l-0.2-1.7H6.9C6.9,7.6,7,8.9,7,10.4V19h4v-7.1c0-0.4,0-0.7,0.1-1c0.3-0.7,0.8-1.6,1.9-1.6c1.4,0,2,1.2,2,2.8V19h4v-7.4 C19,7.9,17.1,6.2,14.6,6.2z"></path></svg></a><a href="https://youtube.com/asyncapi" target="_blank" class="ml-6 text-gray-400 hover:text-red-600"><span class="sr-only">YouTube</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-6 w-6"><path d="M10,2.3C0.172,2.3,0,3.174,0,10s0.172,7.7,10,7.7s10-0.874,10-7.7S19.828,2.3,10,2.3z M13.205,10.334l-4.49,2.096 C8.322,12.612,8,12.408,8,11.974V8.026C8,7.593,8.322,7.388,8.715,7.57l4.49,2.096C13.598,9.85,13.598,10.15,13.205,10.334z"></path></svg></a></div><div class="mt-8"><p class="text-center text-base leading-6 text-gray-400">Made with <span class="font-mono text-pink-500">:love:</span> by the AsyncAPI Initiative.</p><p class="text-center text-base leading-6 text-gray-400 mt-4"><a href="https://netlify.com" target="_blank"><img src="https://www.netlify.com/img/global/badges/netlify-color-bg.svg" class="inline"/></a></p><p class="text-center text-base leading-6 text-gray-400 mt-4">Copyright Â© AsyncAPI Project a Series of LF Projects, LLC.</p><p class="text-center text-base leading-6 text-gray-400 mt-1">For web site terms of use, trademark policy and general project policies please see <a href="https://lfprojects.org" class="text-gray-700 underline" target="_blank">https://lfprojects.org</a></p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/blog/websocket-part3","query":{},"buildId":"Tex625tf_lnUaoCgL3YGh","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/runtime/polyfills-9a3984dd490beb07be5c.js"></script><script async="" data-next-page="/_app" src="/_next/static/Tex625tf_lnUaoCgL3YGh/pages/_app.js"></script><script async="" data-next-page="/blog/websocket-part3" src="/_next/static/Tex625tf_lnUaoCgL3YGh/pages/blog/websocket-part3.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.4dd1003cc9c949c7fcd3.js" async=""></script><script src="/_next/static/chunks/75fc9c18.3cfc8ccb85c1d7a11215.js" async=""></script><script src="/_next/static/chunks/ce56b752.ae226c74e10a6a4b10b8.js" async=""></script><script src="/_next/static/chunks/0557f841fc85a2834d7f888fce8afe60a4489f1d.c7c389ed4e650b7acdd9.js" async=""></script><script src="/_next/static/chunks/5d64a570782c3ceba4f83b61f6533a7ee91bc9f8.3990439058315e1f2df7.js" async=""></script><script src="/_next/static/chunks/be6d319af1fb18412639ef154d1e4d762d2a273e.4cb9699241b781436ae4.js" async=""></script><script src="/_next/static/chunks/4f5700c3a68d16ffc40162e6214bdf91e1aeaf40.af98a8a489a62e744487.js" async=""></script><script src="/_next/static/runtime/main-9425739e3a9a3f3edaa6.js" async=""></script><script src="/_next/static/Tex625tf_lnUaoCgL3YGh/_buildManifest.js" async=""></script><script src="/_next/static/Tex625tf_lnUaoCgL3YGh/_ssgManifest.js" async=""></script></body></html>