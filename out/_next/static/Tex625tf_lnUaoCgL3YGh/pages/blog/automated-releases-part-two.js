(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return g}));var a=n("q1tI"),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),p=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return(o.a.createElement(l.Provider,{value:t},e.children))},b="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return(o.a.createElement(o.a.Fragment,{},t))}},h=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),b=a,h=u["".concat(i,".").concat(b)]||u[b]||m[b]||r;return n?o.a.createElement(h,s(s({ref:t},l),{},{components:n})):o.a.createElement(h,s({ref:t},l))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[b]="string"===typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},Ff2n:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}n.d(t,"a",(function(){return a}))},JoAX:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var a=n("wx14"),o=n("Ff2n"),r=n("q1tI"),i=n.n(r),s=n("7ljp"),c=(i.a.createElement,{}),l="wrapper";function p(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(s.b)(l,Object(a.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},"tl;dr\n",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"/blog/automated-releases/"}),"Here")," you can find the first blog post about automated releasing. The purpose of this blog post is to show how you can do the same automation in non-JavaScript projects. Even if JavaScript community created tooling, you can still use it in other projects and don't freak out.")),Object(s.b)("p",null,"This post and the ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"/blog/automated-releases/"}),"previous one")," come from our experience we gained when working on full automation for all tools maintained by ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/asyncapi/asyncapi/"}),"AsyncaPI Initiative"),"."),Object(s.b)("blockquote",null,Object(s.b)("p",{parentName:"blockquote"},Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/asyncapi/asyncapi/"}),"AsyncAPI")," is a specification that you use to create machine-readable definitions of your event-driven APIs. ")),Object(s.b)("p",null,"The previous post focused on JavaScript as the first library that we automated was our ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/asyncapi/generator/"}),"generator"),". It covered publishing to NPM and usage of the JavaScript community ecosystem. Now we have automation rolled out to all our libraries, Go-written too."),Object(s.b)("h2",{id:"what-i-need-to-automate-release"},"What I need to automate release?"),Object(s.b)("p",null,"To automate a release efficiently, you need two things:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Machine-readable information that allows you to identify if a given commit should trigger a release or not."),Object(s.b)("li",{parentName:"ul"},"Tooling that you can easily plug in and configure without the need to write everything from scratch.")),Object(s.b)("p",null,"This automation is possible thanks to the following:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"The ",Object(s.b)("a",Object(a.a)({parentName:"li"},{href:"https://www.conventionalcommits.org/en/v1.0.0/"}),"Conventional Commits")," specification. The purpose of Conventional Commits is to make commits machine-readable but also human-readable. It defines a set of commit prefixes that can be easily parsed and analyzed by tooling and looks good to the human eye too."),Object(s.b)("li",{parentName:"ul"},"The ",Object(s.b)("a",Object(a.a)({parentName:"li"},{href:"https://github.com/semantic-release/semantic-release"}),"Semantic Release")," package and related plugins that support Conventional Commits and publishing to different channels like GitHub, NPM, Slack, and others.")),Object(s.b)("h2",{id:"wheres-the-catch"},"Where's the catch?"),Object(s.b)("p",null,"This blog post is about the automation of releases for non-JavaScript projects. Let me be honest though, solutions I mentioned in the previous chapter come from the JavaScript community."),Object(s.b)("p",null,"The problem is, there are people who ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.reddit.com/r/javascript/comments/9pwzpn/why_do_people_hate_javascript/"}),"Hate JavaScript"),", they truly ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.quora.com/Why-is-JavaScript-so-hated"}),"hate it")," like it is a living thing. Although, I'm personally proud to be an idiot that has a programming language that I can use."),Object(s.b)("p",null,"Conventional Commits specification is heavily inspired by ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#commit-message-format"}),"Angular Commit Guidelines"),". The Semantic Release package and its plugins ecosystem are all Node.js packages."),Object(s.b)("p",null,Object(s.b)("img",Object(a.a)({parentName:"p"},{src:"https://media.giphy.com/media/10FHR5A4cXqVrO/giphy.gif",alt:null}))),Object(s.b)("p",null,"If you have Java or Go project, you can still use these tools. You do not have to keep ",Object(s.b)("inlineCode",{parentName:"p"},"package.json")," in your repository, so don't worry, you can keep your repository clean. The great folks from Semantic Release thought about you too."),Object(s.b)("p",null,Object(s.b)("img",Object(a.a)({parentName:"p"},{src:"https://media.giphy.com/media/QynGWwS6GdOMj6cvmz/giphy-downsized.gif",alt:null}))),Object(s.b)("h2",{id:"using-semantic-release-with-github-action-in-go-project"},"Using Semantic Release with GitHub Action in Go project"),Object(s.b)("p",null,"One of the projects where we use this JavaScript tools is our parser for AsyncAPI documents. It is a ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/asyncapi/parser-go"}),"Go parser"),"."),Object(s.b)("h3",{id:"semantic-release-configuration"},"Semantic Release configuration"),Object(s.b)("p",null,"The Semantic Release package supports configuration files in different formats and file types. You are not bound to ",Object(s.b)("inlineCode",{parentName:"p"},"package.json"),". We chose to use ",Object(s.b)("inlineCode",{parentName:"p"},".releaserc")," file in YAML format but there are ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://github.com/semantic-release/semantic-release/blob/master/docs/usage/configuration.md#configuration-file"}),"other options")," too."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),'---\nbranches:\n- master\nplugins:\n- - "@semantic-release/commit-analyzer"\n  - preset: conventionalcommits\n- - "@semantic-release/release-notes-generator"\n  - preset: conventionalcommits\n- - "@semantic-release/github"\n  - assets:\n    - path: asyncapi-parser.darwin.amd64\n      label: Binary - Darwin AMD64\n    - path: asyncapi-parser.linux.amd64\n      label: Binary - Linux AMD64\n    - path: asyncapi-parser.windows.amd64.exe\n      label: Binary - Windows AMD64\n')),Object(s.b)("p",null,"Our configuration uses plugins to:"),Object(s.b)("ul",null,Object(s.b)("li",{parentName:"ul"},"Analyze Git commits with Conventional Commits specification."),Object(s.b)("li",{parentName:"ul"},"Create a Git tag and generate changelog for release notes."),Object(s.b)("li",{parentName:"ul"},"Publish a release with additional assets. We compile our parser as binaries that are compatible with many platforms and we want to have them easily accessible with each release.")),Object(s.b)("p",null,"We place the configuration under ",Object(s.b)("inlineCode",{parentName:"p"},".github/workflows/"),", next to our GitHub Action release workflow file: ",Object(s.b)("inlineCode",{parentName:"p"},"release.yml"),". It indicates that it is for release only, nothing else."),Object(s.b)("h3",{id:"release-workflow"},"Release workflow"),Object(s.b)("p",null,"Let us have a look at the differences between this workflow and the workflow I described for a typical JavaScript project ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"/blog/automated-releases/"}),"here"),"."),Object(s.b)("p",null,"First, you define a ",Object(s.b)("inlineCode",{parentName:"p"},"test")," job with the Go environment to trigger tests with different versions of Go."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"test:\n  name: 'Testing'\n  runs-on: ubuntu-latest\n  strategy:\n    matrix:\n      go: \n        - '1.14'\n        - '1.13'\n        - '1.12' \n  steps:\n    - name: Checkout repo\n      uses: actions/checkout@v2\n    - name: Setup Go\n      uses: actions/setup-go@v1.1.2\n      with:\n        go-version: '${{ matrix.go }}'\n    - name: Invoking go test\n      run: go test ./...\n")),Object(s.b)("p",null,"The next step is the ",Object(s.b)("inlineCode",{parentName:"p"},"release")," job, where you can differentiate two core steps. The first part is the generation of the binaries that you want to expose in the GitHub release."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"- name: Setup Go\n  uses: actions/setup-go@v1.1.2\n  with:\n    go-version: '1.14'\n- name: Invoking go vet and binaries generation\n  run: |\n    go vet ./...\n    GOOS=darwin GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.darwin.amd64 ./cmd/api-parser/main.go\n    GOOS=linux GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.linux.amd64 ./cmd/api-parser/main.go\n    GOOS=windows GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.windows.amd64.exe ./cmd/api-parser/main.go\n")),Object(s.b)("p",null,"So far, it is all Go-related operations. How about the release? For the release, you need to set up a Node.js environment to run Semantic Release. Node.js community has this excellent package, ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.npmjs.com/package/npx"}),"npx"),", that allows you to run a package without installing it, and this is what you can do here in the workflow."),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"- name: Setup Node.js\n  uses: actions/setup-node@v1\n  with:\n    node-version: 13\n- name: Add plugin for conventional commits\n  run: npm install conventional-changelog-conventionalcommits\n  working-directory: ./.github/workflows\n- name: Release to GitHub\n  working-directory: ./.github/workflows\n  env:\n    GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}\n    GIT_AUTHOR_NAME: asyncapi-bot\n    GIT_AUTHOR_EMAIL: info@asyncapi.io\n    GIT_COMMITTER_NAME: asyncapi-bot\n    GIT_COMMITTER_EMAIL: info@asyncapi.io\n  run: npx semantic-release\n")),Object(s.b)("p",null,"You only have to install ",Object(s.b)("inlineCode",{parentName:"p"},"conventional-changelog-conventionalcommits")," explicitly if you want to use ",Object(s.b)("inlineCode",{parentName:"p"},"conventionalcommits")," preset when analyzing Git commits and generating the changelog:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{}),'plugins:\n- - "@semantic-release/commit-analyzer"\n  - preset: conventionalcommits\n- - "@semantic-release/release-notes-generator"\n  - preset: conventionalcommits\n')),Object(s.b)("p",null,"Take a look at full release workflow for reference:"),Object(s.b)("pre",null,Object(s.b)("code",Object(a.a)({parentName:"pre"},{className:"language-yaml"}),"name: Release\n\non:\n  push:\n    branches:\n      - master\n\njobs:\n  test:\n    name: 'Testing'\n    runs-on: ubuntu-latest\n    strategy:\n      matrix:\n        go: \n          - '1.14'\n          - '1.13'\n          - '1.12' \n    steps:\n      - name: Checkout repo\n        uses: actions/checkout@v2\n      - name: Setup Go\n        uses: actions/setup-go@v1.1.2\n        with:\n          go-version: '${{ matrix.go }}'\n      - name: Invoking go test\n        run: go test ./...\n  \n  release:\n    name: 'Release to GitHub'\n    runs-on: ubuntu-latest\n    needs: \n      - test\n    steps:\n      - name: Checkout repo\n        uses: actions/checkout@v2\n      - name: Setup Go\n        uses: actions/setup-go@v1.1.2\n        with:\n          go-version: '1.14'\n      - name: Invoking go vet and binaries generation\n        run: |\n          go vet ./...\n          GOOS=darwin GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.darwin.amd64 ./cmd/api-parser/main.go\n          GOOS=linux GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.linux.amd64 ./cmd/api-parser/main.go\n          GOOS=windows GOARCH=amd64 go build -o=.github/workflows/asyncapi-parser.windows.amd64.exe ./cmd/api-parser/main.go\n      - name: Setup Node.js\n        uses: actions/setup-node@v1\n        with:\n          node-version: 13\n      - name: Add plugin for conventional commits\n        run: npm install conventional-changelog-conventionalcommits\n        working-directory: ./.github/workflows\n      - name: Release to GitHub\n        working-directory: ./.github/workflows\n        env:\n          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}\n          GIT_AUTHOR_NAME: asyncapi-bot\n          GIT_AUTHOR_EMAIL: info@asyncapi.io\n          GIT_COMMITTER_NAME: asyncapi-bot\n          GIT_COMMITTER_EMAIL: info@asyncapi.io\n        run: npx semantic-release\n")),Object(s.b)("p",null,'You see, you can still have your project "clean" from any JavaScript-specific files and references. Everything you need for running your release with the JavaScript community tooling is only in the release-related configuration.'),Object(s.b)("h2",{id:"conclusion"},"Conclusion"),Object(s.b)("p",null,'I don\'t think I can ever understand this "hate" towards JavaScript. I think, though, that you can "hate" the language, but if you see some amazing tooling built with it, that can increase your productivity, grit your teeth, put bias aside, and enjoy life. Especially, if in exchange you get this excellent feature, notification about release under the Issue and Pull Request:'),Object(s.b)("p",null,Object(s.b)("img",Object(a.a)({parentName:"p"},{src:"/img/posts/pr-indicator.webp",alt:"pr info about release"}))),Object(s.b)("p",null,"In case you want to have more explanation on the release automation subject, I recommend reading ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"/blog/automated-releases/"}),"the first part of the automation story"),". You can also ",Object(s.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.asyncapi.com/slack-invite/"}),"join our Slack")," for further discussion."),Object(s.b)("p",null,Object(s.b)("em",{parentName:"p"},"* Cover photo by ",Object(s.b)("a",Object(a.a)({parentName:"em"},{href:"https://unsplash.com/@rocknrollmonkey"}),"Rock'n Roll Monkey")," on Unsplash")))}p.isMDXComponent=!0},Qetd:function(e,t,n){"use strict";var a=Object.assign.bind(Object);e.exports=a,e.exports.default=e.exports},R0WL:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/automated-releases-part-two",function(){return n("JoAX")}])},wx14:function(e,t,n){"use strict";function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return a}))}},[["R0WL",0,1]]]);