(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{"0gBO":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return u}));var o,i=n("wx14"),a=n("Ff2n"),r=n("q1tI"),s=n.n(r),l=n("7ljp"),c=(s.a.createElement,o="CodeBlock",function(e){return console.warn("Component "+o+" was not imported, exported, or provided by MDXProvider as global scope"),Object(l.b)("div",e)}),p={},d="wrapper";function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(l.b)(d,Object(i.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("p",null,"In this tutorial, you get started with actual code and a (could-be) real-world use case. ","\nLet's pretend you have a company called Smarty Lighting and you do smart-city lighting systems."),Object(l.b)("h1",{id:"system-description"},"System Description"),Object(l.b)("p",null,"You want to create a system capable of turning on/off the streetlights depending on the environmental conditions of each of them:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},'You\'re going to implement an event-driven architecture, with a Message Broker in its "center".'),Object(l.b)("li",{parentName:"ul"},"Streetlights will send information about its environmental lighting to the broker."),Object(l.b)("li",{parentName:"ul"},"None of the services waits for any kind of response. Think about it as ",Object(l.b)("em",{parentName:"li"},"fire and forget"),". You publish messages to the broker and that's it. Your service doesn't know who receives them.")),Object(l.b)("h1",{id:"technology"},"Technology"),Object(l.b)("p",null,"You'll use Node.js to code APIs and Mosquitto as the message broker. Selected technology is irrelevant here, as things explained here in this tutorial are applicable to any other programming language and message brokers."),Object(l.b)("h1",{id:"the-asyncapi-file"},"The AsyncAPI file"),Object(l.b)("p",null,"Let's start by creating an AsyncAPI file to describe your API. It will help you generate the code and the documentation later."),Object(l.b)(c,{mdxType:"CodeBlock"},"asyncapi: '2.1.0'\ninfo:\n  title: Streetlights API\n  version: '1.0.0'\n  description: |\n    The Smartylighting Streetlights API allows you\n    to remotely manage the city lights.\n  license:\n    name: Apache 2.0\n    url: 'https://www.apache.org/licenses/LICENSE-2.0'\nservers:\n  mosquitto:\n    url: mqtt://test.mosquitto.org\n    protocol: mqtt\nchannels:\n  light/measured:\n    publish:\n      summary: Inform about environmental lighting conditions for a particular streetlight.\n      operationId: onLightMeasured\n      message:\n        name: LightMeasured\n        payload:\n          type: object\n          properties:\n            id:\n              type: integer\n              minimum: 0\n              description: Id of the streetlight.\n            lumens:\n              type: integer\n              minimum: 0\n              description: Light intensity measured in lumens.\n            sentAt:\n              type: string\n              format: date-time\n              description: Date and time when the message was sent."),Object(l.b)("p",null,"Let's break it down into pieces:"),Object(l.b)(c,{mdxType:"CodeBlock"},"asyncapi: '2.1.0'\ninfo:\n  title: Streetlights API\n  version: '1.0.0'\n  description: |\n    The Smartylighting Streetlights API allows you\n    to remotely manage the city lights.\n  license:\n    name: Apache 2.0\n    url: 'https://www.apache.org/licenses/LICENSE-2.0'"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"The ",Object(l.b)("inlineCode",{parentName:"li"},"asyncapi")," field indicates you use AsyncAPI version 2.1.0."),Object(l.b)("li",{parentName:"ul"},"Inside the ",Object(l.b)("inlineCode",{parentName:"li"},"info")," field you find information about the API, like its name, version, description, and its license.")),Object(l.b)("p",null,"We're now going for the ",Object(l.b)("inlineCode",{parentName:"p"},"channels")," section. It is used to describe the event names your API will be publishing and/or subscribing to."),Object(l.b)(c,{mdxType:"CodeBlock"},"channels:\n  light/measured:\n    publish:\n      summary: Inform about environmental lighting conditions for a particular streetlight.\n      operationId: onLightMeasured"),Object(l.b)("p",null,"In this example, ",Object(l.b)("inlineCode",{parentName:"p"},"light/measured")," is the channel name your API ",Object(l.b)("inlineCode",{parentName:"p"},"publish")," to. The ",Object(l.b)("inlineCode",{parentName:"p"},"operationId")," property, describes what will be the name of function or method that takes care of this functionality in generated code. To understand how the event should look like when publishing to that channel, there is the ",Object(l.b)("inlineCode",{parentName:"p"},"payload")," property:"),Object(l.b)(c,{mdxType:"CodeBlock"},"      payload:\n        type: object\n        properties:\n          id:\n            type: integer\n            minimum: 0\n            description: Id of the streetlight.\n          lumens:\n            type: integer\n            minimum: 0\n            description: Light intensity measured in lumens.\n          sentAt:\n            type: string\n            format: date-time\n            description: Date and time when the message was sent."),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"Payload")," property defines the content of the event using AsyncAPI schemas. It means that your event payload should contain an ",Object(l.b)("inlineCode",{parentName:"p"},"id")," and a ",Object(l.b)("inlineCode",{parentName:"p"},"lumens")," property \u2014which are integers bigger than zero\u2014, and a ",Object(l.b)("inlineCode",{parentName:"p"},"sentAt")," property that should be a string containing a date and time."),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"JSON Schema Draft 07 is 100% compatible with AsyncAPI schemas.")),Object(l.b)("p",null,"Cool! So you're done with your AsyncAPI file! Let's get into generating code."),Object(l.b)("h1",{id:"generating-code"},"Generating code"),Object(l.b)("p",null,"To generate your code you'll use the ",Object(l.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com/asyncapi/generator"}),"AsyncAPI Generator")," Node.js template."),Object(l.b)("h3",{id:"1-install-the-generator-to-use-it-as-a-command-line-tool"},"1. Install the generator to use it as a command-line tool"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"npm install -g @asyncapi/generator"),Object(l.b)("h3",{id:"2-create-a-directory-for-your-projects-and-enter-it"},"2. Create a directory for your projects and enter it:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},'mkdir streetlights && cd "$_"'),Object(l.b)("h3",{id:"3-create-a-file-with-the-asyncapi-machine-readable-description-you-defined-before-on-windows-use-type-instead-of-cat"},"3. Create a file with the AsyncAPI machine-readable description you defined before. On Windows use ",Object(l.b)("inlineCode",{parentName:"h3"},"type")," instead of ",Object(l.b)("inlineCode",{parentName:"h3"},"cat"),":"),Object(l.b)(c,{language:"yaml",mdxType:"CodeBlock"},"cat <<EOT >> asyncapi.yaml\nasyncapi: '2.1.0'\ninfo:\n  title: Streetlights API\n  version: '1.0.0'\n  description: |\n    The Smartylighting Streetlights API allows you\n    to remotely manage the city lights.\n  license:\n    name: Apache 2.0\n    url: 'https://www.apache.org/licenses/LICENSE-2.0'\nservers:\n  mosquitto:\n    url: mqtt://test.mosquitto.org\n    protocol: mqtt\nchannels:\n  light/measured:\n    publish:\n      summary: Inform about environmental lighting conditions for a particular streetlight.\n      operationId: onLightMeasured\n      message:\n        name: LightMeasured\n        payload:\n          type: object\n          properties:\n            id:\n              type: integer\n              minimum: 0\n              description: Id of the streetlight.\n            lumens:\n              type: integer\n              minimum: 0\n              description: Light intensity measured in lumens.\n            sentAt:\n              type: string\n              format: date-time\n              description: Date and time when the message was sent.\nEOT"),Object(l.b)("h3",{id:"4-trigger-generation-of-the-nodejs-code"},"4. Trigger generation of the Node.js code:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"ag asyncapi.yaml @asyncapi/nodejs-template -o output -p server=mosquitto"),Object(l.b)("h3",{id:"5-and-voil\xe0-list-all-files-in-directory-and-notice-that-nodejs-application-is-generated"},"5. And voil\xe0! List all files in directory and notice that Node.js application is generated:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"cd output && ls"),Object(l.b)("h1",{id:"running-your-code"},"Running your code"),Object(l.b)("h3",{id:"1-install-dependencies-of-newly-generated-application"},"1. Install dependencies of newly generated application:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"npm install"),Object(l.b)("h3",{id:"2-start-the-application"},"2. Start the application:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"npm start"),Object(l.b)("h3",{id:"3-in-another-terminal-install-the-mqttjs-library"},"3. In another terminal install the MQTT.js library:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},"npm install mqtt -g"),Object(l.b)("h3",{id:"4-send-correct-message-to-your-application"},"4. Send correct message to your application:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},'mqtt pub -t \'light/measured\' -h \'test.mosquitto.org\' -m \'{"id": 1, "lumens": 3, "sentAt": "2017-06-07T12:34:32.000Z"}\''),Object(l.b)("h3",{id:"5-send-incorrect-message-to-your-application"},"5. Send incorrect message to your application:"),Object(l.b)(c,{language:"bash",mdxType:"CodeBlock"},'mqtt pub -t \'light/measured\' -h \'test.mosquitto.org\' -m \'{"id": 1, "lumens": "3", "sentAt": "2017-06-07T12:34:32.000Z"}\''),Object(l.b)("h3",{id:"6-go-back-to-the-previous-terminal-and-notice-that-your-application-logs-the-message-you-just-sent-and-errors-related-to-invalid-message"},"6. Go back to the previous terminal and notice that your application logs the message you just sent and errors related to invalid message."),Object(l.b)("h1",{id:"conclusions"},"Conclusions"),Object(l.b)("p",null,"You've learned how to create an AsyncAPI description file and how to generate code from it. The code is a bootstrap and you'll need to add your business logic into it. Take some time to play with it.\nThere are still lots of things to be covered but intent of this tutorial is to be simple so you get an idea of the potential."),Object(l.b)("p",null,"We would also like to see what you create with AsyncAPI. As an open-source project, we're open to proposals, questions, suggestions, and contributions. If you don't feel in the mood to contribute but you're using AsyncAPI, just raise your hand ",Object(l.b)("a",Object(i.a)({parentName:"p"},{href:"https://github.com/asyncapi/asyncapi/issues/new"}),"creating a issue in our Github repo")," or ",Object(l.b)("a",Object(i.a)({parentName:"p"},{href:"https://www.asyncapi.com/slack-invite/"}),"join our Slack channel"),". Don't be shy :)"))}u.isMDXComponent=!0},"7ljp":function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"b",(function(){return m}));var o=n("q1tI"),i=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=i.a.createContext({}),p=function(e){var t=i.a.useContext(c),n=t;return e&&(n="function"===typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return(i.a.createElement(c.Provider,{value:t},e.children))},u="mdxType",b={inlineCode:"code",wrapper:function(e){var t=e.children;return(i.a.createElement(i.a.Fragment,{},t))}},h=i.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=p(n),u=o,h=d["".concat(r,".").concat(u)]||d[u]||b[u]||a;return n?i.a.createElement(h,s(s({ref:t},c),{},{components:n})):i.a.createElement(h,s({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"===typeof e||o){var a=n.length,r=new Array(a);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"===typeof e?e:o,r[1]=s;for(var c=2;c<a;c++)r[c]=n[c];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},Ff2n:function(e,t,n){"use strict";function o(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,"a",(function(){return o}))},Qetd:function(e,t,n){"use strict";var o=Object.assign.bind(Object);e.exports=o,e.exports.default=e.exports},UATO:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/tutorials/streetlights",function(){return n("0gBO")}])},wx14:function(e,t,n){"use strict";function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return o}))}},[["UATO",0,1]]]);